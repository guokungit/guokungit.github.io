---
title: 浏览器安全
date: 2022-05-24 09:12:51
tags: 安全
---
# 浏览器安全

## web网页安全

### 同源策略

- 协议、域名和端口都相同
- 浏览器默认两个相同的源之间是可以相互访问资源和操作 DOM 的
- 主要表现在 DOM、Web 数据和网络这三个层面
- 跨域共享数据

	- cros

- 跨文档共享消息

	- 操作dom
	- postMessage

### CSP 的核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联 JavaScript 代码。

### xss

- 恶意代码注入攻击

	- 存储型攻击

		- 将恶意脚本发送给服务器，服务器存储在数据库中

	- 反射型攻击

		- 不存储，将恶意脚本由服务器再返回给浏览器

	- 基于 DOM 的 XSS 攻击

		- 在 Web 资源传输过程或者在用户使用页面的过程中修改 Web 页面的数据

- 阻止策略

	- 原理：以通过阻止恶意 JavaScript 脚本的注入和恶意消息的发送来实现。
	- 1、服务器对输入脚本进行过滤或转码
	- 2. 充分利用 CSP

		- 限制加载其他域下的资源文件，这样即使黑客插入了一个 JavaScript 文件，这个JavaScript 文件也是无法被加载的；
		- 禁止向第三方域提交数据，这样用户数据也不会外泄；禁止执行内联脚本和未授权的脚本；
		- 还提供了上报机制，这样可以帮助我们尽快发现有哪些 XSS 攻击，以便尽快修复问题。

	- 3. 使用 HttpOnly 属性

		- 使用 HttpOnly 标记的 Cookie 只能使用在 HTTP 请求过程中，所以无法通过 JavaScript 来读取这段 Cookie。
		- httpOnly由响应头设置

###  CSRF 攻击，

- CSRF 攻击就是黑客利用了用户的登录状态，并通过第三方的站点来做一些坏事

	- 1、自动发送get请求
	- 2、自动发送post请求
	- 3、引诱用户点击链接
	- 和 XSS 不同的是，CSRF 攻击不需要将恶意代码注入用户的页面，仅仅是利用服务器的漏洞和用户的登录状态来实施攻击。

- 阻止攻击

	- 1. 充分利用好 Cookie 的 SameSite 属性

		- 在set-cookie时设置
		- strict

			- 完全禁止第三方站点请求带上cookie

		- lax

			- 运行get请求

				- post，img，iframe加载url时不允许的

		- none

			- 完全开放请求

	- 2. 验证请求的来源站点

		- Referer 是 HTTP 请求头中的一个字段，记录了该 HTTP 请求的来源地址。
		- Origin 和 Referer 的一个主要区别。

			- Origin 属性只包含了域名信息，并没有包含具体的 URL 路径，
			- origin更优先

	- 3. CSRF Token

		- 有服务器想页面中注入csrf token，当在该页面发起请求时带上该信息
		- 第三方站点没有对应的csrf token

## 浏览器系统安全

### 安全沙箱
![安全沙箱](安全沙箱.png)

- 将渲染进程和操作系统隔离的这道墙就是我们要聊的安全沙箱。
- 浏览器中的安全沙箱是利用操作系统提供的安全技术，让渲染进程在执行过程中无法访问或者修改操作系统中的数据，在渲染进程需要访问系统资源的时候，需要通过浏览器内核来实现，然后将访问的结果通过 IPC 转发给渲染进程。
- 安全沙箱最小的保护单位是进程。

![渲染进程与浏览器内核](渲染进程与浏览器内核.png) 

### 无法阻止xss，csrf的攻击

## 浏览器网络安全

![浏览器安全](浏览器安全.png)

### https加解密

- 对称加密

	- 对称加密是指加密和解密都使用的是相同的密钥。

![对称加密](对称加密.png)

- 非对称加密

	- 非对称加密算法有 A、B 两把密钥，如果你用 A 密钥来加
密，那么只能使用 B 密钥来解密；反过来，如果你要 B 密钥来加密，那么只能用 A 密钥来
解密。

![非对称加密](非对称加密.png)

	- 缺点

		- 第一个是非对称加密的效率太低。
		- 第二个是无法保证服务器发送给浏览器的数据安全。

- 对称加密和非对称加密搭配使用

	- 在传输数据阶段依然使用对称加密，但是对称加密的密钥我们采用非对称加密来传输。

![对称混合非对称加密](对称混合非对称加密.png)

- 添加数字证书

![数字证书](数字证书.png)

	- ca证书中包含公司信息，公钥，等。
	- ca签名，hash函数对ca证书中的信息生成信息摘要，私钥加密生成ca签名

		- 证书验证

			- 浏览器获取ca证书后，用同样的hash函数生成信息摘要，用公钥解密签名生成信息摘要2，两两对比

